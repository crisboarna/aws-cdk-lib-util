"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[253],{583:(a,e,t)=>{t.r(e),t.d(e,{assets:()=>o,contentTitle:()=>r,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var n=t(1085),i=t(1184);const s={sidebar_position:1},r="LambdaUtilStack",c={id:"stacks/lambda",title:"LambdaUtilStack",description:"Stack props can be found in LambdaProps",source:"@site/docs/stacks/lambda.md",sourceDirName:"stacks",slug:"/stacks/lambda",permalink:"/aws-cdk-lib-util/docs/stacks/lambda",draft:!1,unlisted:!1,editUrl:"https://github.com/crisboarna/aws-cdk-lib-util/tree/master/packages/docs/docs/stacks/lambda.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Introduction",permalink:"/aws-cdk-lib-util/docs/intro"},next:{title:"actionViaCustomResource",permalink:"/aws-cdk-lib-util/docs/utilities/cdkcustomresourceutil/actionviacustomresource"}},o={},l=[{value:"Example",id:"example",level:2}];function d(a){const e={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...a.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h1,{id:"lambdautilstack",children:"LambdaUtilStack"}),"\n",(0,n.jsxs)(e.p,{children:["Stack props can be found in ",(0,n.jsx)(e.a,{href:"https://github.com/crisboarna/aws-cdk-lib-util/tree/master/packages/aws-cdk-lib-util/src/lambda/LambdaUtilStack.ts",children:"LambdaProps"})]}),"\n",(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:"https://github.com/crisboarna/react-cv/tree/master/apps/infra/src/config/lambda.ts",children:"Example configuration"})}),"\n",(0,n.jsxs)(e.p,{children:["This stack provides an ",(0,n.jsx)(e.code,{children:"L3"})," equivalent construct that creates a Lambda with:"]}),"\n",(0,n.jsxs)(e.ol,{children:["\n",(0,n.jsx)(e.li,{children:"Versioning and Aliasing, each Cloudformation deployment releases a new version and updates alias"}),"\n",(0,n.jsxs)(e.li,{children:["Extra actions that allow configuring external interactions with the lambda by providing the ",(0,n.jsx)(e.code,{children:"scope"}),", ",(0,n.jsx)(e.code,{children:"alias"}),", ",(0,n.jsx)(e.code,{children:"role"})," and ",(0,n.jsx)(e.a,{href:"https://github.com/crisboarna/aws-cdk-lib-util/tree/master/packages/aws-cdk-lib-util/src/lambda/LambdaUtilStack.ts",children:"other"})]}),"\n",(0,n.jsx)(e.li,{children:"SQS DLQ"}),"\n",(0,n.jsx)(e.li,{children:"Alarms sent to SNS topic"}),"\n",(0,n.jsx)(e.li,{children:"Layers support via arn, zip, parameter store arn"}),"\n",(0,n.jsx)(e.li,{children:"VPC support"}),"\n",(0,n.jsx)(e.li,{children:"Role generation per environment"}),"\n"]}),"\n",(0,n.jsx)(e.h2,{id:"example",children:"Example"}),"\n",(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:"language-typescript",metastring:'title="YourStack.ts"',children:"import { App } from 'aws-cdk-lib';\nimport { LambdaUtilStack } from 'aws-cdk-lib-util';\n\nconst app = new App();\n\nexport const lambdaCvExport: LambdaProps = {\n  alarmTopicParam: `/${PROJECT_NAME_MAIN.toLowerCase()}${PARAM_SNS_ALARMS_ARN}`,\n  artifactPath: artifactPathCvExport,\n  environmentGeneration: () => ({\n    APP_NAME: nameCapitalizedCvExport,\n    CV_URL: `cv.${process.env.CDK_DOMAIN_NAME}`,\n  }),\n  extraActions: ({ lambdaAlias }) =>\n    lambdaAlias.grantInvoke(\n      new ServicePrincipal('cloudformation.amazonaws.com')\n    ),\n  isInVpc: false,\n  isProvisioned: false,\n  managedPolicies: ['service-role/AWSLambdaBasicExecutionRole'],\n  memorySize: 1024,\n  layers: [{ paramName: PARAM_LAMBDA_CV_EXPORT_LAYER_ARN }],\n  name: `${PROJECT_NAME}-${nameCapitalizedCvExport}`,\n  paramName: PARAM_LAMBDA_CV_EXPORT_ALIAS_ARN,\n  paramNameRole: PARAM_LAMBDA_CV_EXPORT_ROLE_ARN,\n  runtime: Runtime.NODEJS_14_X,\n  policies: (env, stackEnv) =>\n    getApiIAMPolicies(lambdaNameCvExport)(env, PROJECT_NAME, stackEnv),\n};\n\nconst lambda = new LambdaUtilStack(\n  app,\n  `${PROJECT_NAME}-Lambda-API-${process.ENV}`,\n  lambdaCvExport\n);\n"})})]})}function m(a={}){const{wrapper:e}={...(0,i.R)(),...a.components};return e?(0,n.jsx)(e,{...a,children:(0,n.jsx)(d,{...a})}):d(a)}},1184:(a,e,t)=>{t.d(e,{R:()=>r,x:()=>c});var n=t(4041);const i={},s=n.createContext(i);function r(a){const e=n.useContext(s);return n.useMemo((function(){return"function"==typeof a?a(e):{...e,...a}}),[e,a])}function c(a){let e;return e=a.disableParentContext?"function"==typeof a.components?a.components(i):a.components||i:r(a.components),n.createElement(s.Provider,{value:e},a.children)}}}]);